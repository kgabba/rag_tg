# üß† RAG Telegram Bot (FastAPI + pgvector)

–ú–∏–Ω–∏-MVP: RAG-–±–µ–∫–µ–Ω–¥ –Ω–∞ FastAPI + PostgreSQL/pgvector –∏ Telegram-–±–æ—Ç –Ω–∞ aiogram.

---

## ‚öôÔ∏è –°—Ç–µ–∫

- FastAPI ‚Äî HTTP API
- PostgreSQL + pgvector ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- OpenAI (gpt-4o-mini, text-embedding-3-small) ‚Äî LLM –∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
- aiogram ‚Äî Telegram-–±–æ—Ç
- Docker + docker-compose ‚Äî –∑–∞–ø—É—Å–∫ –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
- pgAdmin ‚Äî –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫ –ë–î

---

## üìÅ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- `app/main.py` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI
- `app/llm/deps.py` ‚Äî LLM, —ç–º–±–µ–¥–¥–∏–Ω–≥–∏, —á–∞–Ω–∫–∏–Ω–≥, –ø–∞—Ä—Å–∏–Ω–≥ PDF/DOCX
- `app/llm/routers.py` ‚Äî —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã `/llm/*`
- `app/db/utils.py` ‚Äî —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ë–î
- `app/tg_bot/bot_main.py` ‚Äî Telegram-–±–æ—Ç
- `db/init.sql` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è pgvector
- `docker-compose.yml` ‚Äî —Å–µ—Ä–≤–∏—Å—ã `postgres`, `pgadmin`, `api`, `bot`

---

## üîê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`)

–°–æ–∑–¥–∞–π—Ç–µ `.env` –≤ –∫–æ—Ä–Ω–µ:

```env
# Postgres / pgvector
DB_USER=postgres
DB_PASSWORD=postgres
DB_NAME=mydb
DB_URL=postgresql://postgres:postgres@postgres:5432/mydb

# pgAdmin
PGADMIN_EMAIL=admin@example.com
PGADMIN_PASSWORD=admin

# OpenAI
API_KEY=sk-...

# Telegram
BOT_TOKEN=–≤–∞—à_–±–æ—Ç_—Ç–æ–∫–µ–Ω
API_BASE_URL=http://api:8000  # –∏–º—è —Å–µ—Ä–≤–∏—Å–∞ –∏–∑ docker-compose

# (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è /llm/embed)
ADMIN_TG_ID=123456789
```

---

## üöÄ –ó–∞–ø—É—Å–∫

```bash
docker compose up --build
```

–ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞:

* API: [http://localhost:8000/docs](http://localhost:8000/docs)
* pgAdmin: [http://localhost:5050](http://localhost:5050) (–ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –∏–∑ `.env`)
* –ë–æ—Ç: –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∫ —Å–µ—Ä–≤–∏—Å `bot` –∏ —Å–ª—É—à–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Telegram

---

## üìö –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã API

* `POST /llm/ask` ‚Äî RAG-–æ—Ç–≤–µ—Ç –ø–æ –≤–æ–ø—Ä–æ—Å—É

  ```json
  { "text": "–≤–∞—à –≤–æ–ø—Ä–æ—Å" }
  ```

* `POST /llm/embed_file` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ PDF/DOCX (–¥–æ 4 –ú–ë), `multipart/form-data`, –ø–æ–ª–µ `file`

* `POST /llm/embed` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è ADMIN_TG_ID —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `tg_id`)

---

## ü§ñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞

1. –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ –≤ Telegram (–ø–æ —Å–≤–æ–µ–º—É —Ç–æ–∫–µ–Ω—É —á–µ—Ä–µ–∑ BotFather).
2. –ù–∞–ø–∏—à–∏—Ç–µ `/start`.
3. –í –¥–∏–∞–ª–æ–≥–µ:

   * –ù–∞–∂–º–∏—Ç–µ **üß† –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å** ‚Üí –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç ‚Üí –±–æ—Ç –¥–µ—Ä–≥–∞–µ—Ç `/llm/ask`.
   * –ù–∞–∂–º–∏—Ç–µ **üìÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª** ‚Üí –æ—Ç–ø—Ä–∞–≤—å—Ç–µ PDF/DOCX ‚â§ 4 –ú–ë ‚Üí –±–æ—Ç –¥–µ—Ä–≥–∞–µ—Ç `/llm/embed_file`.

–ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–æ, —á—Ç–æ –µ—Å—Ç—å –≤ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —á–∞–Ω–∫–∞—Ö (—Å—Ç—Ä–æ–≥–∏–π RAG, –±–µ–∑ —Ñ–∞–Ω—Ç–∞–∑–∏–∏).

---

## üîß –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

* **–û—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π**: —É–¥–∞–ª–∏—Ç–µ –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `chunks`.
* **–ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤**: –∑–∞–ø—Ä–æ—Å –∫ `/llm/ask` —Å `text: "—Ç–µ—Å—Ç"` –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
* **–õ–æ–≥–∏**: –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã `api` –∏ `bot` –ø–∏—à—É—Ç –ª–æ–≥–∏ –≤ stdout, –∏—Ö –º–æ–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å —á–µ—Ä–µ–∑ `docker compose logs <service_name>`.

---

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

* –§–∞–π–ª—ã: —Ç–æ–ª—å–∫–æ PDF –∏ DOCX, –º–∞–∫—Å. 4 –ú–ë.
* –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–æ, —á—Ç–æ –±—ã–ª–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ —Ä–∞–Ω–µ–µ.
* –í–µ—Å—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ RAG-–æ—Ç–≤–µ—Ç–µ ‚Äî —ç—Ç–æ 5 –±–ª–∏–∂–∞–π—à–∏—Ö —á–∞–Ω–∫–æ–≤ –∏–∑ pgvector (–∫–æ—Å–∏–Ω—É—Å–Ω–∞—è –±–ª–∏–∑–æ—Å—Ç—å).
* –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –Ω—É–∂–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏, –≤–æ–∑–º–æ–∂–Ω–æ, –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤.

---

